#!/bin/bash

# TODO: this needs to be autogenerated
export ZITADEL_MASTERKEY="MasterkeyNeedsToHave32Characters"

# Remove zitadel docker data
echo
echo "=> Removing previous Zitadel instance..."
docker compose down -v

# Create zitadel instance
echo
echo "=> Creating new Zitadel instance..."
docker compose up --detach

# Wait 30 seconds
echo
echo "=> Waiting for Zitadel instance to become ready..."
sleep 30

# Terraform bootstrap
echo
echo "=> Bootstrapping Zitadel..."
rm -rf bootstra/*.tfstate
terraform -chdir=bootstrap plan
terraform -chdir=bootstrap apply -auto-approve

echo
echo "[!] DONE"
# Generate artifact data
